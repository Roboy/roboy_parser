# Roboy Parser Grammar

## POS Tags
(rule $Verb ($PHRASE) (FilterPosTagFn span VB VBD VBN VBG VBP VBZ VBD-AUX))
(rule $ProNoun ($TOKEN) (FilterPosTagFn token PRP PRP$))
(rule $ProNounEnd ($TOKEN) (FilterPosTagFn token POS))
(rule $Preposition ($TOKEN) (FilterPosTagFn token IN))
(rule $Conj ($TOKEN) (FilterPosTagFn token CC))
(rule $Det ($TOKEN) (FilterPosTagFn token DT PDT))
(rule $Wh ($TOKEN) (FilterPosTagFn token WP WP$))
(rule $Number ($PHRASE) (FilterPosTagFn span CD))
(rule $BE ($PHRASE) (FilterPosTagFn span BE))
(rule $HAVE ($PHRASE) (FilterPosTagFn span HAVE))

# Words ignored
(rule $Ignore ($LEMMA_PHRASE) (FilterPosTagFn span BE HAVE MD FW RB RBR RBS UH EX DT PDT TO))
(rule $LEMMAS ($Ignore $LEMMA_PHRASE) (SelectFn 1))
(rule $LEMMAS ($LEMMA_PHRASE $Ignore) (SelectFn 0))

## Limiting number of words in a phrase
(rule $VerbPhrase ($LEMMAS) (FilterPosTagFn span IN VB VBD VBN VBG VBP VBZ VBD-AUX))
(rule $ValuePhrase ($PHRASE) (FilterPosTagFn span NN NNP CD))
(rule $NounPhrase ($PHRASE) (FilterPosTagFn span NN))
(rule $EntityPhrase ($PHRASE) (FilterPosTagFn span NNP))
(rule $AdjPhrase ($LEMMAS) (FilterPosTagFn span JJ))
(rule $AdjToken ($AdjPhrase) (FilterSpanLengthFn 1 2))
(rule $VerbToken ($VerbPhrase) (FilterSpanLengthFn 1 2))
(rule $ValueToken ($ValuePhrase) (FilterSpanLengthFn 1 2))
(rule $NounToken ($NounPhrase) (FilterSpanLengthFn 1 3))
(rule $EntityToken ($EntityPhrase) (FilterSpanLengthFn 1 4))
(rule $IgnPhrase ($Ignore) (FilterSpanLengthFn 1 3))
(rule $Limited ($LEMMA_PHRASE) (FilterSpanLengthFn 1 3))

## SimpleLexiconFn

### Unaries
(rule $FullObjProp ($Limited) (SimpleLexiconFn (type "IntersectiveObjectPropertyAdjective")))
(rule $FullObjProp ($Limited) (SimpleLexiconFn (type "ObjectProperty")))

(rule $FullDataProp ($Limited) (SimpleLexiconFn (type "DataPropertyNoun")))
(rule $FullDataProp ($Limited) (SimpleLexiconFn (type "IntersectiveDataPropertyAdjective")))

(rule $FullObjType ($Limited) (SimpleLexiconFn (type "ClassNoun")))
(rule $FullObjType ($Limited) (SimpleLexiconFn (type "RoboyClassNoun")))

### Binaries
(rule $PartObjProp ($Limited) (SimpleLexiconFn (type "RelationalNoun")))
(rule $PartDataProp ($Limited) (SimpleLexiconFn (type "RelationalNoun")))
(rule $RObjProp ($Limited) (SimpleLexiconFn (type "RoboyRelNoun")))
(rule $RDataProp ($Limited) (SimpleLexiconFn (type "RoboyDataProp")))

(rule $PartObjProp ($Limited) (SimpleLexiconFn (type "StateVerb")))
(rule $PartObjProp ($Limited) (SimpleLexiconFn (type "RelationalAdjective")))

(rule $RObjProp ($Limited) (SimpleLexiconFn (type "ObjProp")))
(rule $RDataProp ($Limited) (SimpleLexiconFn (type "DataProp")))

### Entities
(rule $Entity ($EntityToken) (SimpleLexiconFn (type "NamedEntity")))
(rule $Person ($ProNoun) (SimpleLexiconFn (type "Person")))

## OpenTypes
(when error
    (rule $FullObjType ($NounToken) (OpenTypeFn type))
    (rule $FullDataProp ($NounToken) (OpenTypeFn type))

    (rule $PartObjProp ($NounToken) (OpenTypeFn relation))
    (rule $PartDataProp ($NounToken) (OpenTypeFn relation))
    (rule $PartObjProp ($VerbToken) (OpenTypeFn relation))
    (rule $PartDataProp ($VerbToken) (OpenTypeFn relation))

    (rule $Entity ($EntityToken) (OpenTypeFn entity))
)
#(rule $ROOT ($PHRASE) (OpenTypeFn type))
#(rule $ROOT ($PHRASE) (OpenTypeFn relation))
#(rule $ROOT ($PHRASE) (OpenTypeFn entity))

## Forming Subject
(rule $Subject ($Person) (IdentityFn))
(rule $Subject ($Entity) (IdentityFn))
(rule $Subject ($Subject or $Subject) (ConcatFn ";"))
(rule $Subject ($Subject ($Conj optional) $Subject) (ConcatFn ","))
(rule $Subject ($Subject (, optional) $Subject) (ConcatFn ","))

(rule $RobSubject ($Person) (IdentityFn))
(rule $RobSubject ($RobSubject or $RobSubject) (ConcatFn ";"))
(rule $RobSubject ($RobSubject ($Conj optional) $RobSubject) (ConcatFn ","))
(rule $RobSubject ($RobSubject (, optional) $RobSubject) (ConcatFn ","))

## Forming Predicate
(rule $Predicate ($PartObjProp) (IdentityFn))
(rule $Predicate ($PartDataProp) (IdentityFn))
(rule $Predicate ($Predicate or $Predicate) (ConcatFn ";"))
(rule $Predicate ($Predicate ($Conj optional) $Predicate) (ConcatFn ","))
(rule $Predicate ($Predicate (, optional) $Predicate) (ConcatFn ","))

(rule $RObjPred ($RObjProp) (IdentityFn))
(rule $RObjPred ($BE $RObjPred) (SelectFn 1))
(rule $RObjPred ($HAVE $RObjPred) (SelectFn 1))
(rule $RObjPred ($IgnPhrase $RObjPred) (SelectFn 1))
(rule $RObjPred ($RObjPred $IgnPhrase) (SelectFn 0))
(rule $RObjPred ($RObjPred or $RObjPred) (ConcatFn ";"))
(rule $RObjPred ($RObjPred ($Conj optional) $RObjPred) (ConcatFn ","))
(rule $RObjPred ($RObjPred (, optional) $RObjPred) (ConcatFn ","))

(rule $RDataPred ($RDataProp) (IdentityFn))
(rule $RDataPred ($BE $RDataProp) (SelectFn 1))
(rule $RDataPred ($HAVE $RDataProp) (SelectFn 1))
(rule $RDataProp ($IgnPhrase $RDataProp) (SelectFn 1))
(rule $RDataProp ($RDataProp $IgnPhrase) (SelectFn 0))
(rule $RDataPred ($RDataPred or $RDataPred) (ConcatFn ";"))
(rule $RDataPred ($RDataPred ($Conj optional) $RDataPred) (ConcatFn ","))
(rule $RDataPred ($RDataPred (, optional) $RDataPred) (ConcatFn ","))

## Forming Objects
(rule $Object ($Subject) (IdentityFn))
(rule $Object ($BE $Object) (SelectFn 1))
(rule $Object ($Object or $Object) (ConcatFn ";"))
(rule $Object ($Object ($Conj optional) $Object) (ConcatFn ","))
(rule $Object ($Object (, optional) $Object) (ConcatFn ","))

## Forming POs
(rule $PredObj ($FullObjProp) (IdentityFn))
(rule $PredObj ($FullObjType) (IdentityFn))
(rule $PredObj ($FullDataProp) (IdentityFn))
(rule $ROOT ($PredObj) (IdentityFn))

## Forming Values
(rule $Value ($ValueToken) (IdentityFn))
(rule $Value ($BE $ValueToken) (SelectFn 1))
(rule $Value ($Value or $Value) (ListFn))
(rule $Value ($Value ($Conj optional) $Value) (ListFn))
(rule $Value ($Value (, optional) $Value) (ListFn))

# Expressions Roboy
############################################################
(rule $Expr ($RobSubject $RObjPred $Object) (TripleFn spo))
#(rule $Expr ($RobSubject $RObjPred $Value) (TripleFn spo))
(rule $Expr ($RobSubject $RDataPred $Value) (TripleFn spo))
(rule $Expr ($Object $RobSubject $RObjPred ) (TripleFn osp))
#(rule $Expr ($Value $RobSubject $RObjPred ) (TripleFn osp))
(rule $Expr ($Value $RobSubject $RDataPred) (TripleFn osp))
(rule $Expr ($RObjPred $RobSubject $Object) (TripleFn pso))
(rule $Expr ($RDataPred $RobSubject $Value) (TripleFn pso))
(rule $ROOT ($Expr) (IdentityFn))
(rule $ROOT ($Expr ($Conj optional) $Expr) (ListFn))
(rule $ROOT ($PHRASE) (SimpleLexiconFn (type "RoboyPhrases")))


# Questions
############################################################
(rule $Quest (who) (ConstantFn (rdf:type foaf:person) foaf:person))
(rule $Quest (who) (ConstantFn (rdf:type dbpedia:Organization) dbpedia:Organization))
(rule $Quest (who) (ConstantFn (rdf:type dbpedia:Company) dbpedia:Company))
(rule $Quest (where) (ConstantFn (rdf:type dbpedia:Organization) dbpedia:Organization))
(rule $Quest (where) (ConstantFn (rdf:type dbpedia:Place) dbpedia:Place))
(rule $Quest (where) (ConstantFn (rdf:type dbpedia:EducationalInstitution) dbpedia:EducationalInstitution))
(rule $Quest (when) (ConstantFn (rdf:type xsd:date) xsd:date))
(rule $Quest (what) (ConstantFn null null))
(rule $Quest (tell me (something optional)) (ConstantFn null null))
(rule $Quest (date) (ConstantFn (rdf:type xsd:date) xsd:date))
(rule $Quest (year) (ConstantFn (rdf:type xsd:date) xsd:date))
(rule $Quest (day) (ConstantFn (rdf:type xsd:date) xsd:date))

# Aggregation
(rule $CountStr (how many) (ConstantFn null null))
(rule $CountStr (number of) (ConstantFn null null))
(rule $Operator ($CountStr) (ConstantFn (lambda x (count (var x))) (-> fb:type.any fb:type.any)))

# Roboy questions
(rule $RBaseSet ($Person ($Limited optional) $RObjPred) (JoinFn unary,binary unaryCanBeArg0 unaryCanBeArg1))
(rule $RBaseSet ($RObjPred ($Limited optional) $Person) (JoinFn binary,unary unaryCanBeArg0 unaryCanBeArg1))
(rule $RBaseSet ($Person ($Limited optional) $RDataProp) (JoinFn unary,binary unaryCanBeArg0 unaryCanBeArg1))
(rule $RBaseSet ($RDataProp ($Limited optional) $Person) (JoinFn binary,unary unaryCanBeArg0 unaryCanBeArg1))
(rule $RSet ($RBaseSet) (IdentityFn))
(rule $RSet ($RSet ($Limited optional) $RSet) (MergeFn and))

(rule $QExpr (($Limited optional) $Operator ($Limited optional) $Set) (JoinFn forward betaReduce))
(rule $QExpr (($Limited optional) $Set ($Limited optional)) (IdentityFn))
(rule $QExpr (($Limited optional) $Operator ($Limited optional) $RSet) (JoinFn forward betaReduce))
(rule $QExpr (($Limited optional) $RSet ($Limited optional)) (IdentityFn))
(rule $ROOT ($Quest $QExpr) (SelectFn 1))

# DBpedia questions
(rule $Set ($Unary $Set) (MergeFn and))
(rule $Set ($Binary $Entity) (JoinFn forward))
(rule $Set ($Entity $Binary) (JoinFn backward))
(rule $Set ($Binary $Entity) (JoinFn forward))
(rule $Set ($Entity $Binary) (JoinFn backward))
(rule $Unary ($PredObj) (IdentityFn))
#(rule $ROOT ($Entity) (IdentityFn))
(rule $Set ($Unary) (IdentityFn))
(rule $BaseSet ($Subject ($Limited optional) $Predicate) (JoinFn unary,binary unaryCanBeArg0 unaryCanBeArg1))
(rule $BaseSet ($Predicate ($Limited optional) $Subject) (JoinFn binary,unary unaryCanBeArg0 unaryCanBeArg1))
(rule $BaseSet ($Object ($Limited optional) $Predicate) (JoinFn unary,binary unaryCanBeArg0 unaryCanBeArg1))
(rule $BaseSet ($Predicate ($Limited optional) $Object) (JoinFn binary,unary unaryCanBeArg0 unaryCanBeArg1))
(rule $BaseSet ($Value ($Limited optional) $Predicate) (JoinFn unary,binary unaryCanBeArg0 unaryCanBeArg1))
(rule $BaseSet ($Predicate ($Limited optional) $Value) (JoinFn binary,unary unaryCanBeArg0 unaryCanBeArg1))
(rule $Set ($BaseSet) (IdentityFn))
(rule $Set ($Set ($Limited optional) $Set) (MergeFn and))
(rule $ROOT ($Quest $Set) (SelectFn 1))

# Math expressions
(include math.grammar)
